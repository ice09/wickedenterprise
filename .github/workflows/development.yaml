name: Wicked Prototype Push

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: '11'
          distribution: 'adopt'
          cache: maven
      - name: Maven Package
        run: mvn -B clean spring-boot:build-image
      - name: Maven Verify
        run: mvn -B clean verify

  docker:
    name: Publish - Docker Hub
    runs-on: ubuntu-18.04
    needs: [build]
    env:
      REPO: ${{ secrets.DOCKER_REPO }}
    steps:
      - uses: actions/checkout@v1
      - name: Set up JDK 11
        uses: actions/setup-java@v1
        with:
          java-version: 11.0.4
      - name: Login to Docker Hub
        run: docker login -u ${{ secrets.DOCKER_USER }} -p ${{ secrets.DOCKER_TOKEN }}
      - name: Publish Docker image neo4j
        run: docker push neo4j-writer:0.0.1-SNAPSHOT
      - name: Publish Docker image rdbms
        run: docker push rdbms-writer:0.0.1-SNAPSHOT
      - name: Publish Docker image listener
        run: docker push blockchain-listener:0.0.1-SNAPSHOT